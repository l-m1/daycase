<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        // const s = new Set();
        // [2,3,4,5,66,2,2].forEach(x => s.add(x));
        // for(let i of s) {
        //     console.log(i);
        // }

        //例一
        // const set = new Set([1,2,3,4,4]);
        // console.log([...set]);  // 1,2,3,4
        //例二
        // const items = new Set([1,2,3,4,5,6,5,5]);
        // console.log(items.size);  //6
        // //例三
        // const set = new Set(document.querySelectorAll('div'));
        // console.log(set.size);  //0

        //类似于
        // const set = new Set();
        // document
        //     .querySelectorAll('div')
        //     .forEach(div => set.add(div));
        // console.log(set.size);  //0

        // [...new Set(array)]  //去除数组的重复成员
        // [...new Set('ababbc')].join('')  //去除重复字符串

        // let set = new Set();
        // let a = NaN;
        // let b = NaN;
        // set.add(a);
        // set.add(b);
        // console.log(set);  //Set{NaN}

        //两个空对象不相等
        // let set = new Set();
        // set.add({});
        // console.log(set.size);  //1
        // set.add({});
        // console.log(set.size);  //2

        // let s = new Set();
        // s.add(1).add(2).add(2);
        // console.log(s.size);  // 2
        // console.log(s.has(1));  //true
        // console.log(s.has(2)); //true
        // console.log(s.has(3)); //false
        // console.log(s.delete(2)); //true
        // console.log(s.has(2));  //false
        
        // //判断是否包含一个属性，object和set的不同写法
        // //对象的写法
        // const properties = {
        //   'width': 1,
        //   'height': 1
        // };
        // if(properties[someName]) {

        // }
        // //Set的写法
        // const properties = new Set();
        // properties.add('width');
        // properties.add('height');
        // if(properties.has[someName]) {

        // }
        // const items = new Set([1,2,3,4,5]);
        // const array = Array.from(items);
        // console.log(array);

        // function dedupe(array) {
        //   return Array.from(new Set(array));
        // }
        // console.log(dedupe([1,2,3,4,3,1]));  //[1,2,3,4]

        // let set = new Set(['red','green','blue']);
        // for(let item of set.keys()) {
        //   console.log(item);
        // } //red green blue

        // for(let item of set.values()) {
        //   console.log(item);
        // } // red green blue

        // for(let item of set.entries()) {
        //   console.log(item);
        // } // ["red",'red'] ["green":"green"] ["blue":"blue"]

        // //Set结构的实例默认可遍历 使用的它的values方法
        // console.log(Set.prototype[Symbol.iterator] === Set.prototype.values);  //true

        // let set = new Set(['blue','green','red']);
        // for(let item of set) {
        //   console.log(item);
        // } // blue green red

        // let set = new Set([1,4,9]);
        // set.forEach((value,key) => console.log(key + ':' + value))  // 1:1 4:4 9:9

        // let set = new Set(['blue','green','red']);
        // let arr = [...set]
        // console.log(arr);  // ['blue','green','red']

        // let arr = [1,2,3,4,5,4,8];
        // let unique = [...new Set(arr)];
        // console.log(unique);  //[1,2,3,4,5,8]

        // let set = new Set([1,2,3]);
        // set = new Set([...set].map(x => x * 2));
        // console.log(set);  //2 4 6
        // let set = new Set([1,2,3,4,5,6]);
        // set = new Set([...set].filter(x => (x%2) == 0));
        // console.log(set); //2 4 6

        // let a = new Set([1,2,3]);
        // let b = new Set([4,3,2]);
        // //并集
        // let union = new Set([...a,...b]);
        // console.log(union); // {1,2,3,4}
        // //交集
        // let intersect = new Set([...a].filter(x => b.has(x)));
        // console.log(intersect);  //{2,3}
        // //差集  b相对于a所没有的
        // let difference = new Set([...a].filter(x => !b.has(x)));
        // console.log(difference);  //1

        //遍历过程 同时改变set结构
        //方法一
        // let set = new Set([1,2,3]);
        // set = new Set([...set].map(val => val * 2));
        // console.log(set);  //{2,4,6}
        //方法二
        // let set = new Set([1,2,3]);
        // set = new Set(Array.from(set,val => val * 2));
        // console.log(set);  //{2,4,6}

        //WeakSet  
        // const ws = new WeakSet();
        // //console.log(ws.add(1)); //报错
        // console.log(ws.add(Symbol())); //报错

        // const a = [[1,2,3],[3,4]];
        // const ws = new WeakSet(a);
        // console.log(ws);  // {[1,2,3],[3,4]}

        // const b = [2,3];
        // const ws = new WeakSet(b);  //b的成员传给a 成员不是对象
        // console.log(ws); //报错

        // const ws = new WeakSet();
        // const obj = {};
        // const foo = {};

        // ws.add(window);
        // ws.add(obj); //添加至ws中

        // console.log(ws.has(window)); //true
        // console.log(ws.has(foo));  //false

        // ws.delete(window);
        // console.log(ws.has(window)); //false
        // //没有size属性，没法遍历
        // console.log(ws.size);  //false
        // console.log(ws.forEach); //false
        // ws.forEach(function(item) {  // ws.forEach is not a function
        //   console.log('WeakSet has' + item);
        // })

        // const foos = new WeakSet()
        // class Foo {
        //   constructor() {
        //     foos.add(this)
        //   }
        //   method() {
        //     if(!foos.has(this)) {
        //       throw new TypeError('Foo.prototype.method 只能在Foo实例上调用!');
        //     }
        //   }
        // }

        //Map
        // const data = {};
        // const element = document.getElementById('myDiv');
        // data[element] = 'metadata';
        // data['[object HTMLDivElement]']

        // const m = new Map();
        // const o = {p: 'Hello World'};

        // m.set(o,'content')
        // console.log(m.get(o)); // content
        // m.has(o) //true
        // m.delete(o) // true
        // m.has(o) // false

        // const map = new Map([
        //   ['name','张三'],
        //   ['title','Author']
        // ]);
        // console.log(map.size);  //2
        // console.log(map.has('name')); // true
        // console.log(map.get('name'));  // 张三
        // console.log(map.has('title')); //true
        // console.log(map.get('title')); //Author

        // const items = [
        //   ['name','张三'],
        //   ['title','Author']
        // ];
        // const map = new Map();
        // items.forEach(
        //   ([key,value]) => map.set(key,value)
        // );

        // const set = new Set([
        //   ['foo',1],
        //   ['bar',2]
        // ]);
        // const m1 = new Map(set);
        // m1.get('foo') // 1
        // const m2 = new Map([['baz',3]]);
        // const m3 = new Map(m2);
        // m3.get('baz') // 3
        
        // const map = new Map();
        // map
        // .set(1,'aaa')
        // .set(1,'bbb');
        // console.log(map.get(1));  // bbb

        //console.log(new Map().get('ajfbskf'));  // undefined
        // const map = new Map();
        // map.set(['a',555]);
        // console.log(map.get(['a']));  // undefined

        // const map = new Map();
        // const k1 = ['a'];
        // const k2 = ['b'];
        // map
        // .set(k1,111)
        // .set(k2,222);
        // console.log(map.get(k1));  // 111
        // console.log(map.get(k2));  // 222

        // let map = new Map();
        // map.set(-0,123);
        // console.log(map.get(+0));  // 123

        // let map = new Map();
        // map.set(true,1);
        // map.set('true',2);
        // console.log(map.get(true));  // 1
        // map.set(undefined,3);
        // map.set(null,4);
        // map.get(undefined)  // 3
        // map.set(NaN,123);
        // map.get(NaN)  // 123

        // const map = new Map();
        // map.set('foo',true);
        // map.set('bar',false);
        // console.log(map.size);  // 2

        // const m = new Map(); 
        // m.set('edition',6)  //键(key)是字符串
        // m.set(262,'standard') //键是数值
        // m.set(undefined,'nah') //键是 undefined
        // console.log(m.has('edition'));  //true
        // console.log('years');  //false
        // console.log(m.has(262));  //true
        // console.log(m.has(undefined)); //true
        // m.delete(undefined);
        // console.log(m.has(undefined));  //false

        // let map = new Map()
        // .set(1,'a')
        // .set(2,'b')
        // .set(3,'c');
        // console.log(map); //{1=>"a" 2=>"b" 3=>"c"}

        // const m = new Map();
        // const hello = function() {
        //   console.log('hello');
        // };
        // m.set(hello,'Hello ES6!') //键是函数
        // m.get(hello) //Hello ES6!

        // let map = new Map();
        // map.set('abc',123);
        // map.set(12,'helllo')
        // console.log(map.size);  // 2
        // map.clear() //清除所有成员
        // console.log(map.size); // 0

        // const map = new Map([
        //   ['F','no'],
        //   ['T','yes'],
        // ]);
        // for(let key of map.keys()) {
        //   console.log(key);
        // } // "F" "T"

        // for(let value of map.values()) {
        //   console.log(value);
        // } // 'no' 'yes'
        // for(let item of map.entries()) {
        //   console.log(item[0],item[1]);
        // } // "F" "no" "T" "yes"
        // for(let [key,value] of map.entries()) {
        //   console.log(key,value);
        // }// "F" "no" "T" "yes"
        // for(let [key,value] of map) {
        //   console.log(key,value);
        // }// "F" "no" "T" "yes"
        // console.log(map[Symbol.iterator] === map.entries);  // true

        // const map = new Map([
        //   [1,'one'],
        //   [2,'two'],
        //   [3,'three'],
        // ]);
        // console.log([...map.keys()]);  //[1,2,3]
        // console.log([...map.values()]);  // ['one','two','three']
        // console.log([...map.entries()]); //[[1,'one'],[2,'two'],[3,'three']]
        // console.log([...map]); //[[1,'one'],[2,'two'],[3,'three']]

        // const map0 = new Map()
        // .set(1,'a')
        // .set(2,'b')
        // .set(3,'c');
        // const map1 = new Map(
        //   [...map0].filter(([k,v]) => k<3)
        // );
        // console.log(map1); // 1=>a 2 =>b
        // const map2 = new Map([...map0].map(([k,v]) => [k*2,'_' + v]));
        // console.log(map2); // 2=>_a 4=>_b 6=>_c

        // let map = new Map()
        // map.forEach(function(value,key,map) {
        //   console.log("Key: %s,Value: %s",key,value);
        // })

        // let map = new Map()
        // const reporter = {
        //   report: function(key,value) {
        //     console.log("Key: %s,Value: %s",key,value);
        //   }
        // };
        // map.forEach(function(value,key,map) {
        //   this.report(key,value);
        // },reporter); // this -> reporter

        // const myMap = new Map()
        // .set(true,7)
        // .set({foo:3},['abc']);
        // [...myMap]
        // console.log(myMap); // [{true,7},[{foo:3},['abc']]]

        // new Map([
        //   [true,7],
        //   [{foo:3},['abc']]
        // ])  //数组转为map

        function strMapToObj(strMap) {
          let obj = Object.create(null);
          for(let [k,v] of strMap) {
            obj[k] = v;
          }
          return obj;
        }
        // const myMap = new Map()
        // .set('yes',true)
        // .set('no',false);
        // strMapToObj(myMap) // {yes:true,no:false}

        // let obj = {'a':1,'b':2};
        // let map = new Map(Object.entries(obj));  //对象转为map
        // console.log(map);

        // function objToMap(obj) {
        //   let strMap = new Map();
        //   for(let k of Object.keys(obj)) {
        //     strMap.set(k,obj[k]);
        //   }
        //   return strMap;
        // }
        // objToMap({yes:true,no:false}) // {'yes' => true,'no' => false}

        // function strMapToJson(strMap) {
        //   return JSON.stringify(strMapToObj(strMap));
        // }
        // let myMap = new Map().set('yes',true).set('no',false);  //键名都是字符串
        // console.log(strMapToJson(myMap)); //'{"yes":true,"no":false}'

        // function mapToArrayJson(map) {//转成数组JSON
        //   return JSON.stringify([...map]);
        // }
        // let myMap = new Map().set(true,7).set({foo:3},['abc']); //键名不都是字符串
        // console.log(mapToArrayJson(myMap)); '[[true,7],[{"foo":3},["abc"]]]'

        // function jsonToStrMap(isonStr) {
        //   return objToStrMap(JSON.parse(isonStr));
        // }
        // jsonToStrMap('{"yes":true,"no":false}')  //{'yes' => true,'no' => false}

        // function jsonToMap(jsonStr) {
        //   return new Map(JSON.parse(jsonStr));
        // }
        // console.log(jsonToMap('[[true,7],[{"foo":3},["abc"]]]')); //Map {true => 7, Object {foo:3} => ['abc']}

        // const wm1 = new WeakMap();
        // const key = {foo:1};
        // wm1.set(key,2);
        // wm1.get(key) //2

        // const k1 = [1,2,3];
        // const k2 = [4,5,6];
        // const wm2 = new WeakMap([[k1,'foo'],[k2,'bar']]);
        // wm2.get(k2) //"bar"

        // const map = new WeakMap();
        // map.set(1,2)
        // map.set(Symbol(),2)
        // map.set(null,2) //都报错

        // const e1 = document.getElementById('foo');
        // const e2 = document.getElementById('bar');
        // const arr = [
        //   [e1,'foo元素'],
        //   [e2,'bar元素'],
        // ]
        // //一旦不需要就要进行手动删除
        // arr[0] = null;
        // arr[1] = null;
        // const wm = new WeakMap();
        // const element = document.getElementById('example');
        // wm.set(element,'some information');
        // wm.get(element) // some information

        // const wm = new WeakMap();
        // let key = {};
        // let obj = {foo:1};

        // wm.set(key,obj);
        // obj = null;
        // wm.get(key)  //Object {foo:1}

        // const wm = new WeakMap();
        // console.log(wm.size); //undefined
        // console.log(wm.forEaach); //undefined
        // console.log(wm.clear); //undefined

        // let myWeakmap = new WeakMap();
        // myWeakmap.set(
        //   document.getElementsByTagName('logo'),
        //   {timesClicked:0});
        // document.getElementsById('logo').addEventListener('click',function() {
        //   let logoData = myWeakmap.get(document.getElementById('logo'));
        //   logoData.timesClicked++;
        // },false);

        const _counter = new WeakMap();
        const _action = new WeakMap();

        class Countdown {
          constructor(counter,action) {
            _counter.set(this,counter);  //内部属性 实例的弱引用
            _action.set(this,action); //删除实例，内部属性自动消失 不会造成内存泄漏
          }
          dec() {
            let counter = _counter.get(this);
            if(counter < 1) return;
            counter--;
            _counter.set(this,counter);
            if(counter === 0) {
              _action.get(this)();
            }
          }
        }

        const c = new Countdown(2,() => console.log('DONE'));
        c.dec()  //DONE
    </script>
</body>
</html>